(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0da6fae8","chunk-4c4bb366"],{"00a2":function(t,e,n){"use strict";n("83a2")},"0a1b":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return r}));var a=n("bd2b");t="/app/";function i(e){return Object(a["a"])({url:t+"vFlow/def/insert",method:"post",data:e})}function o(e){return Object(a["a"])({url:t+"vFlow/def/get",method:"post",data:e})}function s(e){return Object(a["a"])({url:t+"vFlow/task/startAble",method:"post",data:e})}function r(e){return Object(a["a"])({url:t+"vFlow/def/start",method:"post",data:e})}},"1fdb":function(t,e,n){"use strict";n("251f")},"251f":function(t,e,n){},"2bf5":function(t,e,n){"use strict";n("961d")},"83a2":function(t,e,n){},"891a":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{padding:"10px"}},[n("v-form-render",{ref:"vFormRef",attrs:{"form-json":t.formJson,"form-data":t.formData,"data-dic-api":t.dataDicApi,"option-data":t.optionData}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showButton,expression:"showButton"}],staticClass:"center"},[n("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v(t._s(null!=t.localDefId?"保存并流转":"保存"))])],1),n("el-dialog",{attrs:{visible:t.showCheckBox,"append-to-body":""},on:{"update:visible":function(e){t.showCheckBox=e}}},[t.showCheckBox?n("check-box",{attrs:{"candidate-users":t.candidateUsers,"candidate-groups":t.candidateGroups,"form-start":!0},on:{checkDone:t.startFlow}}):t._e()],1)],1)},i=[],o=(n("a9e3"),n("e9c4"),n("89a5")),s=n("5f87"),r=n("ad66"),l=n("ca33"),c={name:"Render",components:{checkBox:l["default"]},props:{templatePkId:{type:Number,default:function(){return null}},pkId:{type:Number,default:function(){return null}},defId:{type:String,default:function(){return null}},candidateUsers:{type:Array,default:function(){return[]}},candidateGroups:{type:Array,default:function(){return[]}},assignee:{type:String,default:function(){return null}},formData:{type:Object,default:function(){return{}}}},data:function(){return{dataDicApi:{URL:r["a"]+"user/sysCode/listEnum",headers:{Authorization:Object(s["a"])()},key:"fkId"},formJson:{},optionData:{},localTemplatePkId:this.templatePkId,localPkId:this.pkId,localDefId:this.defId,localProId:null,localAssignee:null,showButton:!1,showCheckBox:!1}},mounted:function(){this.localTemplatePkId||(this.localTemplatePkId=this.$route.query.templatePkId,this.localPkId=this.$route.query.pkId),this.localTemplatePkId&&this.localPkId?this.getFormData():this.getFormJson(this.formData)},methods:{submitForm:function(){var t=this;this.$refs.vFormRef.getFormData().then((function(e){t.localDefId&&null==t.localProId?t.assignee?t.saveData(e):t.candidateUsers.length>0||t.candidateGroups.length>0?t.showCheckBox=!0:t.$message.error("当前流程未配置受理人，且未配置候选组/候选用户，无法启动。"):t.saveData(e)})).catch((function(e){t.$message.error(e)}))},startFlow:function(t){var e=this;this.showCheckBox=!1,this.localAssignee=t,this.$refs.vFormRef.getFormData().then((function(t){e.saveData(t)})).catch((function(t){e.$message.error(t)}))},saveData:function(t){var e=this,n={form:t,flow:{defId:this.localDefId,assignee:this.localAssignee,proId:this.localProId},pkId:this.localPkId,templatePkId:this.localTemplatePkId};Object(o["e"])(n).then((function(t){e.$message.success("保存成功");var n=t.data,a=n.pkId,i=n.flow;e.localPkId=a,e.localDefId=i.defId,e.localProId=i.proId}))},getFormJson:function(t){var e=this;Object(o["c"])({pkId:this.localTemplatePkId}).then((function(n){e.$refs.vFormRef.setFormJson(n.data.template),t&&e.$nextTick((function(){e.$refs.vFormRef.setFormData(t),e.showButton=!0}))}))},getFormData:function(){var t=this;Object(o["a"])({pkId:this.localPkId,templatePkId:this.localTemplatePkId}).then((function(e){var n=e.data,a=n.flow,i=n.form,o=Object.assign(JSON.parse(JSON.stringify(t.formData)),i);t.getFormJson(o),t.localDefId=a.defId,t.localProId=a.proId}))}}},u=c,d=(n("1fdb"),n("2877")),h=Object(d["a"])(u,a,i,!1,null,"3a8b1a30",null);e["default"]=h.exports},"89a5":function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"e",(function(){return s})),n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return l}));var a=n("bd2b");t="/app/";function i(e){return Object(a["a"])({url:t+"fromDesigner/insert",method:"post",data:e})}function o(e){return Object(a["a"])({url:t+"fromDesigner/getById",method:"post",data:e})}function s(e){return Object(a["a"])({url:t+"fromDesigner/save",method:"post",data:e})}function r(e){return Object(a["a"])({url:t+"fromDesigner/get",method:"post",data:e})}function l(e){return Object(a["a"])({url:t+"fromDesigner/getByExistTable",method:"post",data:e})}},"961d":function(t,e,n){},ca33:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tt"},[n("avue-form",{ref:"formRef",attrs:{option:t.option},on:{submit:t.startFlow},model:{value:t.form,callback:function(e){t.form=e},expression:"form"}})],1)},i=[],o=(n("d81d"),n("c24f")),s=n("0a1b"),r={name:"",props:{defId:{type:String,default:function(){return null}},candidateUsers:{type:Array,default:function(){return[]}},candidateGroups:{type:Array,default:function(){return[]}},formStart:{type:Boolean,default:function(){return!1}}},data:function(){return{form:{candidateUsers:null},assignee:null,option:{submitText:"发起流程",emptyBtn:!1,labelPosition:"top",tabs:!0,group:[],column:[]}}},created:function(){this.init()},methods:{init:function(){this.initUsers(),this.initGroups()},initUsers:function(){var t=this;if(this.candidateUsers.length>0){var e=Object(o["d"])({ids:this.candidateUsers}),n=[{label:"",prop:"candidateUsers",type:"radio",dicData:e,span:24,click:function(e){if("INPUT"!==e.event.target.tagName)return!1;var n=e.column;return t.check(n["prop"])}}],a={label:"候选用户",arrow:!1,prop:"group1",column:n};this.option.group.push(a)}},initGroups:function(){var t=this;if(this.candidateGroups.length>0){var e=Object(o["c"])({ids:this.candidateGroups}).map((function(e){return{label:e.label,prop:"candidateGroups"+e.value,type:"radio",dicData:e.children,span:24,click:function(e){if("INPUT"!==e.event.target.tagName)return!1;var n=e.column;return t.check(n["prop"])}}})),n={label:"候选组",arrow:!1,prop:"group2",column:e};this.option.group.push(n)}},check:function(t){var e=this.$refs.formRef.form;for(var n in e)n!==t&&(e[n]=void 0);return this.assignee=t,!0},startFlow:function(t,e){var n=this;null==this.assignee?(e(),this.$message.error("请选择处理人")):this.formStart?(e(),this.$emit("checkDone",t[this.assignee])):Object(s["c"])({defId:this.defId,assignee:t[this.assignee]}).then((function(t){n.$message.success("流程启动成功，请返回我发起的查询发起任务"),e(),n.$emit("checkDone")}))}}},l=r,c=(n("00a2"),n("2877")),u=Object(c["a"])(l,a,i,!1,null,"7b803908",null);e["default"]=u.exports},ce3e:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-row",{staticStyle:{"padding-top":"10px"}},[n("el-col",{staticClass:"col",attrs:{span:24}},[n("avue-crud",{ref:"crud",attrs:{"table-loading":t.tableLoading,data:t.data,option:t.option,search:t.search,page:t.page},on:{"update:search":function(e){t.search=e},"update:page":function(e){t.page=e},"search-change":t.searchChange,"search-reset":t.resetChange,"refresh-change":t.refreshChange,"size-change":t.sizeChange,"current-change":t.currentChange,select:t.selectionChange,"select-all":t.selectionChange},scopedSlots:t._u([{key:"menu",fn:function(e){var a=e.row,i=e.index;return t._l(t.inLineButton,(function(e,o){return n("el-button",{key:o,attrs:{type:"primary",icon:e.icon,size:"small"},on:{click:function(n){"行删除"==e.name?t.deleteBatch(a,i):t.callMethod(e.clickEvent,a)}}},[t._v(t._s(e.name))])}))}}])},[n("template",{slot:"searchMenu"},t._l(t.headButton,(function(e,a){return n("el-button",{key:a,attrs:{type:"行保存"!=e.name?"primary":"success",icon:e.icon,size:"small"},on:{click:function(n){"行保存"==e.name?t.saveBatch():"行新增"==e.name?t.addBatch():t.callMethod(e.clickEvent)}}},[t._v(t._s(e.name))])})),1),t.showSearch?n("template",{slot:"menuLeft"},t._l(t.headButton,(function(e,a){return n("el-button",{key:a,attrs:{type:"行保存"!=e.name?"primary":"success",icon:e.icon,size:"small"},on:{click:function(n){"行保存"==e.name?t.saveBatch():"行新增"==e.name?t.addBatch():t.callMethod(e.clickEvent)}}},[t._v(t._s(e.name))])})),1):t._e()],2)],1),n("el-dialog",{attrs:{visible:t.form.dialogVisible},on:{"update:visible":function(e){return t.$set(t.form,"dialogVisible",e)},closed:function(e){return t.refreshChange()}}},[t.form.dialogVisible?n("form-render",{attrs:{"template-pk-id":t.form.templatePkId,"pk-id":t.form.pkId,"form-data":t.list.formData}}):t._e()],1),n("el-dialog",{attrs:{visible:t.listRender.dialogVisible},on:{"update:visible":function(e){return t.$set(t.listRender,"dialogVisible",e)}}},[t.listRender.dialogVisible?n("list-render",{attrs:{"sub-list-template-pk-id":t.listRender.listTemplatePkId,"sub-custom-param":t.listRender.customParam,"sub-form-data":t.listRender.formData,"sub-list-data":t.listRender.listData,"is-sub":!0}}):t._e()],1),n("el-dialog",{attrs:{visible:t.flow.dialogVisible,fullscreen:!0,"custom-class":"flow"},on:{"update:visible":function(e){return t.$set(t.flow,"dialogVisible",e)},closed:function(e){return t.refreshChange(!0)}}},[t.flow.dialogVisible?n("flow-render",{attrs:{"def-id":t.flow.defId}}):t._e()],1),n("el-dialog",{attrs:{visible:t.flow.dialogVisible2},on:{"update:visible":function(e){return t.$set(t.flow,"dialogVisible2",e)},closed:function(e){return t.refreshChange(!0)}}},[t.flow.dialogVisible2?n("start-flow-render"):t._e()],1)],1)},i=[],o=(n("d3b7"),n("3ca3"),n("ddb0"),n("a9e3"),n("4de4"),n("ac1f"),n("841c"),n("b64b"),n("d81d"),n("caad"),n("7db0"),n("2532"),n("891a")),s=n("eb2f"),r=n("f3d5"),l=function(){return Promise.all([n.e("chunk-0ec19c6f"),n.e("chunk-fb976b50")]).then(n.bind(null,"4cec"))},c=function(){return n.e("chunk-6b4ebeb3").then(n.bind(null,"1ca9"))},u={components:{formRender:o["default"],listRender:function(){return Promise.resolve().then(n.bind(null,"4011"))},flowRender:l,startFlowRender:c},extends:Object(r["a"])(),props:{listTemplatePkId:{type:Number,default:function(){return null}},list:{type:Object,default:function(){return{column:[],button:[],rowEdit:!1,selection:!1,buttonWidth:null,customParam:{},formData:{},listData:[]}},deep:!0}},data:function(){return{form:{dialogVisible:!1,templatePkId:null,pkId:null},flow:{dialogVisible:!1,dialogVisible2:!1,defId:null},listRender:{dialogVisible:!1,listTemplatePkId:null,customParam:{},formData:{},listData:[]},buttonParam:[],search:{},delPkIds:[],tableLoading:!0,page:{total:0,currentPage:1,pageSize:10},data:[],option:{menu:!0,menuWidth:null,menuXsWidth:null,menuFixed:!1,searchLabelWidth:100,searchShowBtn:!1,searchMenuSpan:null,searchMenuPosition:"left el-col-xs-24 el-col-sm-12",border:!0,refreshBtn:!1,columnBtn:!1,addBtn:!1,editBtn:!1,delBtn:!1,column:[],selection:!1}}},computed:{inLineButton:function(){var t=this.list.button.filter((function(t){return!t.type}));return this.list.rowEdit&&t.push({icon:"el-icon-delete",name:"行删除"}),t},headButton:function(){var t=this.list.button.filter((function(t){return t.type}));return this.list.rowEdit&&(t.push({icon:"el-icon-plus",name:"行新增"}),t.push({icon:"el-icon-circle-check",name:"行保存"})),t},showSearch:function(){var t=this.option.column.filter((function(t){return!1===t.search})),e=this.list.button.filter((function(t){return t.type}));return this.list.rowEdit&&(e.push({icon:"el-icon-plus",name:"行新增"}),e.push({icon:"el-icon-circle-check",name:"行保存"})),e.length>0&&t.length===this.option.column.length}},watch:{"list.customParam":function(){this.refreshChange()}},created:function(){this.optionInit(),this.dataInit()},methods:{optionInit:function(){this.option.column=this.list.column,this.option.searchMenuSpan=24-6*this.option.column.filter((function(t){return!0===t.search})).length,void 0!==this.list.buttonWidth&&null!==this.list.buttonWidth&&this.list.buttonWidth>0?(this.option.menuWidth=this.list.buttonWidth,this.option.menuXsWidth=this.list.buttonWidth):(this.option.menuWidth=100*this.inLineButton.length,this.option.menuXsWidth=100*this.inLineButton.length),this.option.menu=0!==this.inLineButton.length,this.option.selection=this.list.selection;var t=father["methods"];void 0!==t["initTemplate"]&&t["initTemplate"].call(this,this,r["k"])},dataInit:function(t,e){var n=this,a={currentPage:this.page.currentPage,pageSize:this.page.pageSize},i={templatePkId:this.listTemplatePkId+"",page:a};t&&(i.search=t);var o=Object(r["c"])();0!==Object.keys(this.list.customParam).length&&(o=Object.assign(o,this.list.customParam)),delete o.listTemplatePkId,i.customParam=o,this.tableLoading=!0,Object(r["b"])(i).then((function(t){var a=t.data,i=a.total,o=a.size,s=a.current,r=a.records;n.getExtendData(r),n.data=r,n.page.total=i,n.page.currentPage=s,n.page.pageSize=o,n.option.selection&&n.$nextTick((function(){n.$refs.crud.toggleSelection(n.data.filter((function(t){return 1===t.checked})))})),e&&e(),n.tableLoading=!1}))},getExtendData:function(t){var e=this,n=this.option.column.filter((function(t){return["checkbox"].includes(t.type)})).map((function(t){return t.prop}));(this.list.listData.length>=0||n.length>0)&&t.map((function(t){var a=e.list.listData.find((function(e){var n=e.eq;return Array.isArray(n)?n.every((function(e){return t[e["key"]]===e["value"]})):t[n["key"]]===n["value"]}))||{},i=a.data;i&&Object.assign(t,i),n.map((function(e){t[e]&&(t[e]=JSON.parse(t[e]))}))}))},sizeChange:function(t){this.page.pageSize=t,this.refreshChange()},currentChange:function(t){this.page.currentPage=t,this.refreshChange()},resetChange:function(){this.dataInit()},searchChange:function(t,e){this.dataInit(t,e)},refreshChange:function(t){t?this.$emit("reloadJs",t):this.dataInit(this.search)},selectionChange:function(t,e){var n=!1;e?(e.checked=t.includes(e)?1:0,n=!1):(n=!0,0===t.length?this.data.map((function(t){t.checked=0})):(this.data.map((function(t){t.checked=1})),t.map((function(t){t.checked=1}))));var a=Object.assign({},{originData:this.data,targetData:n&&0===t.length?null:t,selectAll:n,checkedData:e});this.callMethod("selectRow(row)",a)},getQuery:function(t){return Object(r["f"])(t)},addBatch:function(){this.$refs.crud.rowCellAdd(this.list.formData)},saveBatch:function(){var t=this,e={templatePkId:this.listTemplatePkId+"",list:this.data,delPkIds:this.delPkIds};Object(r["i"])(e).then((function(e){t.$message.success("保存成功"),t.delPkIds=[],t.refreshChange()}))},deleteBatch:function(t,e){this.$delete(this.data,e),void 0!==t["pk_id"]&&""!==t["pk_id"]&&this.delPkIds.push(t["pk_id"])},eventBus:function(t,e){s["a"].$emit(t,e)}}},d=u,h=(n("2bf5"),n("2877")),f=Object(h["a"])(d,a,i,!1,null,null,null);e["default"]=f.exports},eb2f:function(t,e,n){"use strict";var a=n("2b0e");e["a"]=new a["default"]}}]);