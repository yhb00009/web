(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ce40d0fe"],{1766:function(s,t,e){s.exports=e.p+"static/img/start.7c90871c.png"},"78a1":function(s,t,e){},d03c:function(s,t,e){s.exports=e.p+"static/img/jp.6e43586c.png"},d314:function(s,t,e){"use strict";e("78a1")},e75d:function(s,t,e){"use strict";e.r(t);var i=function(){var s=this,t=s.$createElement,i=s._self._c||t;return i("div",{staticClass:"lottery-box"},[i("div",{staticClass:"title"}),i("h1",{staticClass:"title2"}),i("div",{staticClass:"lottery"},[i("div",{staticClass:"lottery-item"},[i("div",{staticClass:"lottery-start"},[i("div",{staticClass:"box gray",class:{noShow:0!==s.isStart}},[i("p",[s._v("活动未开始")])]),i("div",{staticClass:"box",class:{noShow:1!==s.isStart},on:{click:s.startLottery}},[i("img",{staticStyle:{"margin-top":"3px"},attrs:{src:e("1766")}})]),i("div",{staticClass:"box gray",class:{noShow:2!==s.isStart}},[i("p",[s._v("活动已过期")])])]),i("ul",s._l(s.list,(function(t,a){return i("li",{key:a,class:{on:a==s.index}},[i("div",{staticClass:"box"},[i("img",{attrs:{src:e("f52f")}})])])})),0)])]),i("div",{staticClass:"mask",class:{noShow:!s.showToast}}),i("div",{staticClass:"lottery-alert",class:{noShow:!s.showToast}},[i("h1",{directives:[{name:"show",rawName:"v-show",value:s.hasLuck,expression:"hasLuck"}]},[s._v("恭喜您")]),i("p",{directives:[{name:"show",rawName:"v-show",value:s.hasLuck,expression:"hasLuck"}]},[i("img",{attrs:{src:e("d03c")}})]),i("h2",{directives:[{name:"show",rawName:"v-show",value:s.hasLuck,expression:"hasLuck"}]},[s._v("获得"+s._s("一袋纸巾"))]),i("h2",{directives:[{name:"show",rawName:"v-show",value:!s.hasLuck,expression:"!hasLuck"}]},[s._v(" "+s._s(s.message))]),i("div",{staticClass:"btnsave",on:{click:function(t){s.showToast=!1}}},[s._v("确定")])])])},a=[],r=e("bd2b"),c="/user/",h="/app/";function o(s){return Object(r["a"])({url:c+"sysUser/getById",method:"post",data:s})}function n(s){return Object(r["a"])({url:h+"order/getVerifyHash",method:"post",data:s})}function u(s){return Object(r["a"])({url:h+"order/luckDraw",method:"post",data:s})}function l(s){return Object(r["a"])({url:h+"order/checkOrderByUserIdInCache",method:"post",data:s})}var d={name:"LuckDraw",data:function(){return{userId:null,sid:1,verifyHash:null,strKey:null,hasResult:!1,hasLuck:!1,message:null,isStart:1,list:[1,2,3,4,5,6,7,8],index:-1,count:8,timer:0,speed:200,times:0,cycle:50,prize:-1,click:!0,showToast:!1}},created:function(){this.getUserId()},methods:{getUserId:function(){var s=this,t=localStorage.getItem("userId");t?(this.userId=t,this.getVerifyHash()):o({}).then((function(t){localStorage.setItem("userId",t.data),s.userId=localStorage.getItem("userId"),s.getVerifyHash()}))},getVerifyHash:function(){var s=this,t={sid:this.sid,userId:this.userId};n(t).then((function(t){s.verifyHash=t.data}))},luckDraw:function(){var s=this,t={sid:this.sid,userId:this.userId,verifyHash:this.verifyHash};u(t).then((function(t){"200"===t.code?(s.strKey=t.data.strKey,s.getResult()):(s.hasResult=!0,s.hasLuck=!1,s.message=t.message)}))},getResult:function(){var s=this;this.strKey;var t={sid:this.sid,userId:this.userId,strKey:this.strKey};l(t).then((function(t){"200"===t.code?(s.hasResult=!0,s.hasLuck=!0):"库存不足"===t.message?(s.hasResult=!0,s.hasLuck=!1):setTimeout(s.getResult,2e3)}))},startLottery:function(){this.click&&this.verifyHash&&this.startRoll()},startRoll:function(){if(this.times+=1,this.oneRoll(),this.times>this.cycle+10&&this.prize===this.index&&this.hasResult){clearTimeout(this.timer),this.prize=-1,this.times=0,this.speed=200,this.click=!0,this.strKey=null;var s=this;setTimeout((function(){s.showToast=!0}),500)}else this.times<this.cycle?this.speed-=10:this.times===this.cycle?(this.prize=parseInt(10*Math.random(),0)||0,this.prize>7&&(this.prize=7),this.luckDraw()):this.times>this.cycle+10&&(0===this.prize&&7===this.index||this.prize===this.index+1)?this.speed+=110:this.speed+=20,this.speed<40&&(this.speed=40),this.timer=setTimeout(this.startRoll,this.speed)},oneRoll:function(){var s=this.index,t=this.count;s+=1,s>t-1&&(s=0),this.index=s}}},p=d,m=(e("d314"),e("2877")),f=Object(m["a"])(p,i,a,!1,null,"ee148cf6",null);t["default"]=f.exports},f52f:function(s,t,e){s.exports=e.p+"static/img/box.c5a3b97f.png"}}]);