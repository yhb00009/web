(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c4bb366"],{"00a2":function(t,e,n){"use strict";n("83a2")},"0a1b":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return i}));var a=n("bd2b");t="/app/";function o(e){return Object(a["a"])({url:t+"vFlow/def/insert",method:"post",data:e})}function r(e){return Object(a["a"])({url:t+"vFlow/def/get",method:"post",data:e})}function s(e){return Object(a["a"])({url:t+"vFlow/task/startAble",method:"post",data:e})}function i(e){return Object(a["a"])({url:t+"vFlow/def/start",method:"post",data:e})}},"1fdb":function(t,e,n){"use strict";n("251f")},"251f":function(t,e,n){},"83a2":function(t,e,n){},"891a":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{padding:"10px"}},[n("v-form-render",{ref:"vFormRef",attrs:{"form-json":t.formJson,"form-data":t.formData,"data-dic-api":t.dataDicApi,"option-data":t.optionData}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showButton,expression:"showButton"}],staticClass:"center"},[n("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v(t._s(null!=t.localDefId?"保存并流转":"保存"))])],1),n("el-dialog",{attrs:{visible:t.showCheckBox,"append-to-body":""},on:{"update:visible":function(e){t.showCheckBox=e}}},[t.showCheckBox?n("check-box",{attrs:{"candidate-users":t.candidateUsers,"candidate-groups":t.candidateGroups,"form-start":!0},on:{checkDone:t.startFlow}}):t._e()],1)],1)},o=[],r=(n("a9e3"),n("e9c4"),n("89a5")),s=n("5f87"),i=n("ad66"),c=n("ca33"),u={name:"Render",components:{checkBox:c["default"]},props:{templatePkId:{type:Number,default:function(){return null}},pkId:{type:Number,default:function(){return null}},defId:{type:String,default:function(){return null}},candidateUsers:{type:Array,default:function(){return[]}},candidateGroups:{type:Array,default:function(){return[]}},assignee:{type:String,default:function(){return null}},formData:{type:Object,default:function(){return{}}}},data:function(){return{dataDicApi:{URL:i["a"]+"user/sysCode/listEnum",headers:{Authorization:Object(s["a"])()},key:"fkId"},formJson:{},optionData:{},localTemplatePkId:this.templatePkId,localPkId:this.pkId,localDefId:this.defId,localProId:null,localAssignee:null,showButton:!1,showCheckBox:!1}},mounted:function(){this.localTemplatePkId||(this.localTemplatePkId=this.$route.query.templatePkId,this.localPkId=this.$route.query.pkId),this.localTemplatePkId&&this.localPkId?this.getFormData():this.getFormJson(this.formData)},methods:{submitForm:function(){var t=this;this.$refs.vFormRef.getFormData().then((function(e){t.localDefId&&null==t.localProId?t.assignee?t.saveData(e):t.candidateUsers.length>0||t.candidateGroups.length>0?t.showCheckBox=!0:t.$message.error("当前流程未配置受理人，且未配置候选组/候选用户，无法启动。"):t.saveData(e)})).catch((function(e){t.$message.error(e)}))},startFlow:function(t){var e=this;this.showCheckBox=!1,this.localAssignee=t,this.$refs.vFormRef.getFormData().then((function(t){e.saveData(t)})).catch((function(t){e.$message.error(t)}))},saveData:function(t){var e=this,n={form:t,flow:{defId:this.localDefId,assignee:this.localAssignee,proId:this.localProId},pkId:this.localPkId,templatePkId:this.localTemplatePkId};Object(r["e"])(n).then((function(t){e.$message.success("保存成功");var n=t.data,a=n.pkId,o=n.flow;e.localPkId=a,e.localDefId=o.defId,e.localProId=o.proId}))},getFormJson:function(t){var e=this;Object(r["c"])({pkId:this.localTemplatePkId}).then((function(n){e.$refs.vFormRef.setFormJson(n.data.template),t&&e.$nextTick((function(){e.$refs.vFormRef.setFormData(t),e.showButton=!0}))}))},getFormData:function(){var t=this;Object(r["a"])({pkId:this.localPkId,templatePkId:this.localTemplatePkId}).then((function(e){var n=e.data,a=n.flow,o=n.form,r=Object.assign(JSON.parse(JSON.stringify(t.formData)),o);t.getFormJson(r),t.localDefId=a.defId,t.localProId=a.proId}))}}},d=u,l=(n("1fdb"),n("2877")),f=Object(l["a"])(d,a,o,!1,null,"3a8b1a30",null);e["default"]=f.exports},"89a5":function(t,e,n){"use strict";n.d(e,"d",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"e",(function(){return s})),n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return c}));var a=n("bd2b");t="/app/";function o(e){return Object(a["a"])({url:t+"fromDesigner/insert",method:"post",data:e})}function r(e){return Object(a["a"])({url:t+"fromDesigner/getById",method:"post",data:e})}function s(e){return Object(a["a"])({url:t+"fromDesigner/save",method:"post",data:e})}function i(e){return Object(a["a"])({url:t+"fromDesigner/get",method:"post",data:e})}function c(e){return Object(a["a"])({url:t+"fromDesigner/getByExistTable",method:"post",data:e})}},ca33:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tt"},[n("avue-form",{ref:"formRef",attrs:{option:t.option},on:{submit:t.startFlow},model:{value:t.form,callback:function(e){t.form=e},expression:"form"}})],1)},o=[],r=(n("d81d"),n("c24f")),s=n("0a1b"),i={name:"",props:{defId:{type:String,default:function(){return null}},candidateUsers:{type:Array,default:function(){return[]}},candidateGroups:{type:Array,default:function(){return[]}},formStart:{type:Boolean,default:function(){return!1}}},data:function(){return{form:{candidateUsers:null},assignee:null,option:{submitText:"发起流程",emptyBtn:!1,labelPosition:"top",tabs:!0,group:[],column:[]}}},created:function(){this.init()},methods:{init:function(){this.initUsers(),this.initGroups()},initUsers:function(){var t=this;if(this.candidateUsers.length>0){var e=Object(r["d"])({ids:this.candidateUsers}),n=[{label:"",prop:"candidateUsers",type:"radio",dicData:e,span:24,click:function(e){if("INPUT"!==e.event.target.tagName)return!1;var n=e.column;return t.check(n["prop"])}}],a={label:"候选用户",arrow:!1,prop:"group1",column:n};this.option.group.push(a)}},initGroups:function(){var t=this;if(this.candidateGroups.length>0){var e=Object(r["c"])({ids:this.candidateGroups}).map((function(e){return{label:e.label,prop:"candidateGroups"+e.value,type:"radio",dicData:e.children,span:24,click:function(e){if("INPUT"!==e.event.target.tagName)return!1;var n=e.column;return t.check(n["prop"])}}})),n={label:"候选组",arrow:!1,prop:"group2",column:e};this.option.group.push(n)}},check:function(t){var e=this.$refs.formRef.form;for(var n in e)n!==t&&(e[n]=void 0);return this.assignee=t,!0},startFlow:function(t,e){var n=this;null==this.assignee?(e(),this.$message.error("请选择处理人")):this.formStart?(e(),this.$emit("checkDone",t[this.assignee])):Object(s["c"])({defId:this.defId,assignee:t[this.assignee]}).then((function(t){n.$message.success("流程启动成功，请返回我发起的查询发起任务"),e(),n.$emit("checkDone")}))}}},c=i,u=(n("00a2"),n("2877")),d=Object(u["a"])(c,a,o,!1,null,"7b803908",null);e["default"]=d.exports}}]);