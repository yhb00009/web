(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e485b4d"],{"30b50":function(e,t,i){e.exports=i.p+"static/img/card.818dc5fe.png"},"3fdb":function(e,t,i){e.exports=i.p+"static/img/btn_bujiao.05d5cdca.png"},b276:function(e,t,i){"use strict";i.r(t),i.d(t,"methods",(function(){return f})),i.d(t,"websocketTest",(function(){return g}));i("b680"),i("ace4"),i("d3b7"),i("cfc3"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("d81d"),i("4e82"),i("fb6a"),i("159b"),i("b0c0"),i("caad"),i("2532"),i("a434"),i("e9c4");var n=i("5a89"),r=i("30b50"),a=i.n(r),o=i("b688"),s=i.n(o),h=i("3fdb"),d=i.n(h),c=i("f8e6"),u=i.n(c),m={0:{name:"大王",x:710,y:646,index:0},1:{name:"小王",x:592,y:646,index:1},2:{name:"♠2",x:710,y:485,index:2},3:{name:"♣2",x:1064,y:163,index:3},4:{name:"♦2",x:474,y:163,index:4},5:{name:"♥2",x:946,y:324,index:5},6:{name:"♠A",x:828,y:485,index:6},7:{name:"♣A",x:1182,y:163,index:7},8:{name:"♦A",x:238,y:2,index:8},9:{name:"♥A",x:1064,y:324,index:9},10:{name:"♠K",x:828,y:646,index:10},11:{name:"♣K",x:1182,y:324,index:11},12:{name:"♦K",x:1300,y:163,index:12},13:{name:"♥K",x:1064,y:485,index:13},14:{name:"♠Q",x:946,y:646,index:14},15:{name:"♣Q",x:1300,y:324,index:15},16:{name:"♦Q",x:1418,y:163,index:16},17:{name:"♥Q",x:1182,y:485,index:17},18:{name:"♠J",x:1064,y:646,index:18},19:{name:"♣J",x:1418,y:324,index:19},20:{name:"♦J",x:2,y:2,index:20},21:{name:"♥J",x:1300,y:485,index:21},22:{name:"♠10",x:1300,y:646,index:22},23:{name:"♣10",x:2,y:163,index:23},24:{name:"♦10",x:120,y:2,index:24},25:{name:"♥10",x:1418,y:485,index:25},26:{name:"♠9",x:1418,y:646,index:26},27:{name:"♣9",x:120,y:163,index:27},28:{name:"♦9",x:2,y:646,index:28},29:{name:"♥9",x:2,y:324,index:29},30:{name:"♠8",x:2,y:485,index:30},31:{name:"♣8",x:238,y:163,index:31},32:{name:"♦8",x:120,y:646,index:32},33:{name:"♥8",x:120,y:324,index:33},34:{name:"♠7",x:120,y:485,index:34},35:{name:"♣7",x:356,y:163,index:35},36:{name:"♦7",x:238,y:646,index:36},37:{name:"♥7",x:238,y:324,index:37},38:{name:"♠6",x:238,y:485,index:38},39:{name:"♣6",x:592,y:163,index:39},40:{name:"♦6",x:356,y:646,index:40},41:{name:"♥6",x:356,y:324,index:41},42:{name:"♠5",x:356,y:485,index:42},43:{name:"♣5",x:710,y:163,index:43},44:{name:"♦5",x:1182,y:646,index:44},45:{name:"♥5",x:474,y:324,index:45},46:{name:"♠4",x:474,y:485,index:46},47:{name:"♣4",x:828,y:163,index:47},48:{name:"♦4",x:946,y:485,index:48},49:{name:"♥4",x:592,y:324,index:49},50:{name:"♠3",x:592,y:485,index:50},51:{name:"♣3",x:946,y:163,index:51},52:{name:"♦3",x:710,y:324,index:52},53:{name:"♥3",x:828,y:324,index:53},54:{name:"背面",x:474,y:646,index:54}},x=function(e,t){var i=(e/1550).toFixed(5),n=(t/809).toFixed(5),r=((e+116)/1550).toFixed(5),a=((t+159)/809).toFixed(5),o=new Float32Array([i,a,r,a,i,n,r,n]);return o},l=function(e,t){var i=new Float32Array([0,1,1,1,0,0,1,0]);return i},f={data:function(){return{bgWidth:1136,bgHeight:768,cdWidth:116,cdHeight:159,moveHeight:20,scene:new n["i"],camera:null,renderer:null,gui:null,leftGroup:new n["c"],rightGroup:new n["c"],mainGroup:new n["c"],outGroup:new n["c"],topGroup:new n["c"],checkMesh:[],buttonGroup:new n["c"]}},methods:{initCardMaterial:function(){return new n["e"]({map:(new n["j"]).load(a.a),transparent:!0})},initButtonMaterial:function(e){return new n["e"]({map:(new n["j"]).load(e),transparent:!0})},initBackGround:function(){var e=new n["e"]({map:(new n["j"]).load(s.a),transparent:!0}),t=new n["d"](new n["g"](this.bgWidth,this.bgHeight),e);t.position.set(0,0,0),this.scene.add(t)},leftPalyer:function(e){for(var t=m[54],i=0;i<e;i++){var r=new n["g"](this.cdWidth,this.cdHeight);r.attributes.uv=new n["b"](x(t.x,t.y),2),this.leftGroup.add(new n["d"](r,this.initCardMaterial()))}this.leftPosition(),this.scene.add(this.leftGroup)},rightPalyer:function(e){for(var t=m[54],i=0;i<e;i++){var r=new n["g"](this.cdWidth,this.cdHeight);r.attributes.uv=new n["b"](x(t.x,t.y),2),this.rightGroup.add(new n["d"](r,this.initCardMaterial()))}this.rightPosition(),this.scene.add(this.rightGroup)},bottomPalyer:function(e){var t=this;e.forEach((function(e){var i=new n["g"](t.cdWidth,t.cdHeight);i.attributes.uv=new n["b"](x(e.x,e.y),2);var r=new n["d"](i,t.initCardMaterial());r.name=e.index,t.mainGroup.add(r)})),this.bottomPosition(),this.scene.add(this.mainGroup)},topPalyer:function(e){var t=this;e.forEach((function(e){var i=new n["g"](t.cdWidth,t.cdHeight);i.attributes.uv=new n["b"](x(e.x,e.y),2),t.topGroup.add(new n["d"](i,t.initCardMaterial()))}));for(var i=this.topGroup.children,r=40,a=0-(i.length-1)*r/2,o=(this.bgHeight-this.cdHeight)/2,s=0;s<i.length;s++)i[s].position.set(a+s*r,o,s+1);this.scene.add(this.topGroup)},button:function(){var e=this,t=[{pic:u.a,index:"chupai"},{pic:d.a,index:"buchu"}],i=211,r=84;t.forEach((function(t){var a=new n["g"](i,r);a.attributes.uv=new n["b"](l(),2);var o=new n["d"](a,e.initButtonMaterial(t.pic));o.name=t.index,e.buttonGroup.add(o)}));for(var a=this.buttonGroup.children,o=i,s=0-(a.length-1)*o/2,h=0-(this.bgHeight-r)/2+this.cdHeight+2*this.moveHeight,c=0;c<a.length;c++)a[c].position.set(s+c*o,h,1);this.buttonGroup.visible=this.palyers.outCard,this.scene.add(this.buttonGroup)},rightPosition:function(){var e=this.rightGroup.children;e.forEach((function(e){return e.rotateZ(1.55)}));for(var t=20,i=(this.bgWidth-this.cdHeight)/2,n=(this.cdHeight-(e.length*t+this.cdWidth))/2,r=0;r<e.length;r++)e[r].position.set(i,n+r*t,r+1)},leftPosition:function(){var e=this.leftGroup.children;e.forEach((function(e){return e.rotateZ(1.55)}));for(var t=20,i=(this.bgWidth-this.cdHeight)/2,n=(this.cdHeight-(e.length*t+this.cdWidth))/2,r=0;r<e.length;r++)e[r].position.set(0-i,n+r*t,r+1)},bottomPosition:function(){for(var e=this.mainGroup.children,t=40,i=0-(e.length-1)*t/2,n=0-(this.bgHeight-this.cdHeight)/2,r=0;r<e.length;r++)e[r].position.set(i+r*t,n,r+1)},outPosition:function(){for(var e=this.outGroup.children,t=40,i=0-(e.length-1)*t/2,n=0,r=0;r<e.length;r++)e[r].position.set(i+r*t,n,r+1)},initCamera:function(){var e=this.bgWidth/this.bgHeight,t=this.bgHeight/2;this.camera=new n["f"](-t*e,t*e,t,-t,1,2e3),this.camera.position.set(0,0,100),this.camera.lookAt(0,0,0)},reloadCamera:function(){var e,t;this.$route.fullPath.includes("index")?this.renderer.setSize(window.innerWidth,window.innerHeight):this.renderer.setSize(window.innerWidth,window.innerHeight-84),window.innerWidth<500?(e=this.bgHeight/this.bgWidth,t=this.bgWidth/2,this.camera.up.set(-1,0,0)):(e=this.bgWidth/this.bgHeight,t=this.bgHeight/2,this.camera.up.set(0,1,0)),this.camera.left=-t*e,this.camera.right=t*e,this.camera.top=t,this.camera.bottom=-t,this.camera.lookAt(0,0,0),this.camera.updateProjectionMatrix()},initRenderer:function(){this.scene.add(this.outGroup),this.scene.add(new n["a"](150)),this.renderer=new n["l"]({antialias:!0}),this.reloadCamera(),this.renderer.render(this.scene,this.camera);var e=this.scene,t=this.camera,i=this.renderer;function r(){i.render(e,t),requestAnimationFrame(r)}r(),document.getElementById("three").appendChild(this.renderer.domElement);var a=this;window.onresize=function(){a.reloadCamera()},this.renderer.domElement.addEventListener("click",(function(e){var i=e.offsetX/window.innerWidth*2-1,r=-e.offsetY/window.innerHeight*2+1,o=new n["h"];o.setFromCamera(new n["k"](i,r),t);var s=o.intersectObjects(a.mainGroup.children);if(s.length>0)a.checkCard(s[0].object);else{var h=o.intersectObjects(a.buttonGroup.children);h.length>0&&a.disCard(h[0].object.name)}}))},checkCard:function(e){var t=this.checkMesh.indexOf(e);-1!==t?(this.checkMesh.splice(t,1),e.position.y-=this.moveHeight):(this.checkMesh.push(e),e.position.y+=this.moveHeight)},disCard:function(e){var t=this;if("buchu"===e)this.checkMesh.length>0?(this.checkMesh.forEach((function(e){e.position.y-=t.moveHeight})),this.checkMesh=[]):this.post([]);else{var i=this.checkMesh.map((function(e){return e.name}));if(!this.palyers.outCard)return void console.log("还不到您CP");this.post(i)}},removeLeft:function(e){for(var t=this.leftGroup.children,i=t.length>e?e:t.length,n=0;n<i;n++)this.leftGroup.remove(t[n]);this.leftPosition()},removeRight:function(e){for(var t=this.rightGroup.children,i=t.length>e?e:t.length,n=0;n<i;n++)this.rightGroup.remove(t[n]);this.rightPosition()},removeBottom:function(){for(var e=this,t=this.outGroup.children,i=t.length-1,n=i;n>=0;n--)this.outGroup.remove(t[n]);this.checkMesh.forEach((function(t){e.outGroup.add(t),e.mainGroup.remove(t)})),this.outPosition(),this.bottomPosition(),this.checkMesh=[]},outCardByOther:function(e){for(var t=this,i=this.outGroup.children,r=i.length-1,a=r;a>=0;a--)this.outGroup.remove(i[a]);e.forEach((function(e){var i=new n["g"](t.cdWidth,t.cdHeight);i.attributes.uv=new n["b"](x(e.x,e.y),2);var r=new n["d"](i,t.initCardMaterial());r.name=e.index,t.outGroup.add(r)})),this.outPosition()}}},g={init:function(e,t){var i=new WebSocket("ws://120.24.168.1:8005/im/socket/message?token="+e),n=function(){i.send(JSON.stringify({method:"ready"})),console.log("客户端连接成功",e)},r=function(n){var r=JSON.parse(n.data),a=r.state;switch(console.log(e,r),a){case 3:var o={method:"agree",key:r.key};i.send(JSON.stringify(o));break;case 4:var s=r.outCard,h=r.cards,d=r.bottomCard,c=r.lastCard,u=r.left,x=r.right;if(t.palyers.outCard=s,t.palyers.cards=h,t.topPalyer(d.map((function(e){return m[e]}))),t.bottomPalyer(h.map((function(e){return m[e]}))),t.leftPalyer(u),t.rightPalyer(x),t.button(),void 0!==c){var l=c.cards;l.length>0&&t.outCardByOther(l.map((function(e){return m[e]})))}break;case 5:var f=r.cards,g=r.winner;console.log(g?"dz":"nm","获胜"),f.length>0&&t.outCardByOther(f.map((function(e){return m[e]})));break;case 6:var p=r.outCard,b=r.cards;t.palyers.outCard!==p&&(t.palyers.outCard=p),b.length>0&&(p?t.removeLeft(b.length):t.removeRight(b.length),t.outCardByOther(b.map((function(e){return m[e]}))));break;case 99:break;case 100:t.removeBottom(),t.palyers.outCard=!1;break}};return i.onopen=n,i.onmessage=r,i}}},b688:function(e,t,i){e.exports=i.p+"static/img/table_bg_1.7f3bf7bc.jpg"},ed17:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"three"}})},r=[],a=(i("e9c4"),i("b276")),o=i("c24f"),s={name:"App",components:{},extends:a["methods"],data:function(){return{user:{},websock:null,palyers:{outCard:!1,cards:[]}}},watch:{"palyers.outCard":{handler:function(e){this.buttonGroup.visible!==e&&(this.buttonGroup.visible=e)}}},created:function(){this.initUser()},mounted:function(){this.init()},methods:{initUser:function(){var e=this;Object(o["b"])().then((function(t){var i=t.data.pkId;e.user={id:i},e.initWebSocket()}))},initWebSocket:function(){this.websock=a["websocketTest"].init(this.user.id,this)},init:function(){this.initBackGround(),this.initCamera(),this.initRenderer()},post:function(e){var t={method:"play",cards:e};return this.websock.send(JSON.stringify(t)),!1}}},h=s,d=i("2877"),c=Object(d["a"])(h,n,r,!1,null,null,null);t["default"]=c.exports},f8e6:function(e,t,i){e.exports=i.p+"static/img/btn_chupai.ce997572.png"}}]);